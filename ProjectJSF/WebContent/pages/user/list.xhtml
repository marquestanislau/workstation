<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head></h:head>
<h:body>
	<ui:composition template="/pages/template/template.xhtml">
		<ui:define name="center">
			<h:form id="frm">
				<h:outputLabel value="Lista de usu&aacute;rios cadastrados."
					style="font-size: 25px;" />
				<p:menubar>
					<f:facet name="options">
						<p:menuitem>
							<p:commandButton type="button" icon="ui-icon-plus"
								onclick="PF('saveDialog').show()" value="Novo Cadastro" />
						</p:menuitem>
						<p:menuitem>
							<p:commandButton type="button" value="Imprimir"
								icon="ui-icon-print" />
						</p:menuitem>
					</f:facet>
				</p:menubar>

				<p:spacer />

				<p:growl id="growl" showDetail="true" showSummary="true"
					autoUpdate="true" />

				<p:panelGrid columns="1" layout="grid">

					<p:dataTable emptyMessage="Sem usuarios cadastrados" id="dataTable"
						var="user" rows="10" value="#{userBean.users}" paginator="true"
						selectionMode="single" selection="#{userBean.user}"
						rowKey="#{user.id}">
						<p:ajax event="rowSelect" listener="#{userBean.onRowSelect}"
							update=":frm:growl" />
						<p:column headerText="Nome">
							<p:outputLabel value="#{user.nome}" />
						</p:column>
						<p:column headerText="Apelido">
							<p:outputLabel value="#{user.apelido}" />
						</p:column>
						<p:column headerText="Email">
							<p:outputLabel value="#{user.email}" />
						</p:column>
						<p:column headerText="Data de registro">
							<p:outputLabel value="#{user.created.time}">
								<f:convertDateTime pattern="dd/MM/yy" type="date" />
							</p:outputLabel>
						</p:column>
						<p:column headerText="Contacto">
							<p:outputLabel value="#{user.cell}" />
						</p:column>
						<p:column headerText="Role">
							<p:outputLabel value="#{user.role.label}"
								styleClass="#{user.role eq 'ADMIN'? 'cor_admin' : 'cor_normal'}" />
						</p:column>
						<p:column headerText="">
							<p:commandButton update=":frm:viewUser"
								oncomplete="PF('view_dialog').show()" icon="ui-icon-search"
								process="dataTable" value="Detalhes" />
						</p:column>
						<p:columnGroup type="footer">
							<p:row>
								<p:column colspan="6" style="text-align: right;"
									footerText="Numero total de usuarios:" />
								<p:column footerText="#{userBean.totalUsers}" />
							</p:row>
						</p:columnGroup>
					</p:dataTable>
				</p:panelGrid>

				<p:dialog widgetVar="view_dialog" closable="true"
					closeOnEscape="true" modal="false" showEffect="slide"
					hideEffect="slide">
					<p:panelGrid id="viewUser" columns="2">
						<f:facet name="header">
							<p:outputLabel value="Detalhes de: " />
							<p:outputLabel value="#{userBean.user.nome}" />
						</f:facet>

						<p:outputLabel value="Nome:" />
						<p:outputLabel value="#{userBean.user.nome}" />

						<p:outputLabel value="Apelido:" />
						<p:outputLabel value="#{userBean.user.apelido}" />

						<p:outputLabel value="Email:" />
						<p:outputLabel value="#{userBean.user.email}" />

						<p:outputLabel value="Cell:" />
						<p:outputLabel value="#{userBean.user.cell}" />

						<p:outputLabel value="Tipo de usuario:" />
						<p:outputLabel value="#{userBean.user.role.label}" />
					</p:panelGrid>
				</p:dialog>

				<h:form id="process_frm">
					<p:dialog widgetVar="saveDialog" closeOnEscape="true"
						closable="true" header="Cadastro de Usuarios" showEffect="drop"
						hideEffect="puff">
						<h:outputLabel style="font-size: 35px;"
							value="Efectue o registo de usuarios." />

						<p:panel header="Dados pessoais do utilizador">
							<p:panelGrid columns="4">
								<h:outputLabel value="Nome: " for="nome" />
								<p:inputText id="nome" required="true"
									value="#{userBean.user.nome}" />
								<h:outputLabel for="apelido" value="Apelido: " />
								<p:inputText id="apelido" required="true"
									value="#{userBean.user.apelido}" />
								<h:outputLabel value="Data de Nascimento: " for="nome" />
								<p:calendar />
								<h:outputLabel value="Detalhes: " for="nome" />
								<p:inputTextarea cols="30" />
							</p:panelGrid>
						</p:panel>
						<p:spacer />
						<p:panel header="Informacoes de contacto">
							<p:panelGrid columns="4">
								<h:outputLabel value="Email: " for="nome" />
								<h:panelGroup>
									<p:inputText id="email"
										validatorMessage="Formato de email invalido!"
										value="#{userBean.user.email}">
										<f:validateRegex
											pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
									</p:inputText>
									<p:watermark for="email" value="exemplo@mail.com" />
								</h:panelGroup>
								<h:outputLabel value="Telemovel: " for="nome" />
								<h:panelGroup>
									<p:inputMask required="true" id="cell"
										mask="(+258)-999-999-999" value="#{userBean.user.cell}" />
									<p:watermark value="(+258)-123-456-789" for="cell" />
								</h:panelGroup>
								<h:outputLabel value="Telemovel alternativo: " for="nome" />
								<p:inputMask mask="" />
							</p:panelGrid>
						</p:panel>
						<p:spacer />
						<p:panel header="Informacoes de registo">
							<p:panelGrid columns="2">
								<h:outputLabel value="Nome do usuario: " for="nome" />
								<p:inputText />
								<h:outputLabel value="Senha: " for="nome" />
								<p:password size="50" feedback="true" weakLabel="Fraco"
									required="true" id="senha" strongLabel="Segura"
									goodLabel="Aceitavel" promptLabel="Digite a palavra passe"
									maxlength="15" />
								<h:outputLabel value="Repita a senha: " for="nome" />
								<p:password size="50" maxlength="15" id="repeatSenha"
									required="true" />
								<p:outputLabel value="Permissao:" />
								<p:selectOneMenu required="true" id="userType"
									value="#{userBean.user.role}">
									<f:selectItem itemLabel="Selecione..." />
									<f:selectItems value="#{userBean.roles}" var="rolex"
										itemValue="#{rolex}" itemLabel="#{rolex.label}" />
								</p:selectOneMenu>
							</p:panelGrid>
						</p:panel>

						<f:facet name="footer">
							<p:outputPanel>
								<p:commandButton icon="ui-icon-circle-plus" value="Salvar"
									action="#{userBean.addUser}" update=":frm:dataTable"
									process="process_frm" />
								<p:commandButton value="Novo" icon="ui-icon-refresh"
									type="reset" />
							</p:outputPanel>
						</f:facet>
					</p:dialog>
				</h:form>
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>
