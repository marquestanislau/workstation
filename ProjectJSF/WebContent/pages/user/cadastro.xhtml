<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<h:head>
</h:head>
<h:body>
	<ui:composition template="/pages/template/template.xhtml">
		<ui:define name="center">

			<h:form id="user_frm">
				<p:menubar>
					<f:facet name="options">
						<p:menuitem>
							<p:commandButton process="@this" value="#{msg.lista_utilizador}"
								icon="ui-icon-person"
								action="/pages/user/list?faces-redirect=true" />
						</p:menuitem>
					</f:facet>
					<p:menuitem>
						<p:commandButton title="Clica para submeter os dados"
							action="#{userBean.addUser}" value="#{msg.salvar}"
							icon="ui-icon-circle-check" update=":frm:dataTable" />
					</p:menuitem>
					<p:menuitem>
						<span class="ui-separator"> <span
							class="ui-icon ui-icon-grip-dotted-vertical" />
						</span>
					</p:menuitem>
					<p:menuitem>
						<p:commandButton value="#{msg.novo}" icon="ui-icon-plus" type="reset" />
					</p:menuitem>

				</p:menubar>

				<p:spacer />
				<p:growl autoUpdate="true" showDetail="true" showSummary="true" />

				<p:panelGrid style="width: 100%;">
					<p:row>
						<p:column>
							<h:outputLabel value="#{msg.nome}" for="nome" />
						</p:column>
						<p:column>
							<p:inputText size="50" label="nome" id="nome" required="true"
								value="#{userBean.user.nome}" />
						</p:column>
						<p:column>
							<h:outputLabel for="apelido" value="#{msg.apelido}" />
						</p:column>
						<p:column>
							<p:inputText label="#{msg.apelido}" id="apelido" required="true"
								value="#{userBean.user.apelido}" />
						</p:column>
					</p:row>

					<p:row>
						<p:column>
							<h:outputLabel for="email" value="#{msg.email}" />
						</p:column>
						<p:column>
							<p:inputText size="50" label="email" id="email"
								validatorMessage="Formato de email invalido!"
								value="#{userBean.user.email}">
								<f:validateRegex
									pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
							</p:inputText>
							<p:watermark for="email" value="#{msg.water_email}"></p:watermark>
						</p:column>
						<p:column>
							<h:outputLabel for="cell" value="#{msg.contacto}" />
						</p:column>
						<p:column>
							<p:inputMask size="50" id="cell" required="true"
								mask="(+258)-999-999-999" value="#{userBean.user.cell}" />
							<p:watermark value="(+258)-123-456-789" for="cell" />
						</p:column>
						<p:column>
							<p:outputLabel value="#{msg.tipo_usuario}" for="user_Type" />
						</p:column>
						<p:column>
							<p:selectOneMenu value="#{userBean.user.role}" id="user_Type"
								required="true">
								<f:selectItem itemLabel="#{msg.water_selecione}" />
								<f:selectItems value="#{userBean.roles}" var="rolex"
									itemValue="#{rolex}" itemLabel="#{rolex.label}" />
							</p:selectOneMenu>
							<p:tooltip value="Seleccione entre Administrador ou Normal."
								for="user_Type" />
						</p:column>
					</p:row>

					<p:row>
						<p:column>
							<p:outputLabel for="senha" value="#{msg.senha}" />
						</p:column>
						<p:column>
							<p:password size="40" feedback="true" required="true" id="senha"
								weakLabel="Fraco" strongLabel="Segura" goodLabel="Aceitavel"
								promptLabel="Digite a palavra passe" maxlength="15"
								placeholder="M&aacute;ximo 15 caracteres" />
						</p:column>
					</p:row>
					<p:row>
						<p:column>
							<p:outputLabel for="repeataSenha" value="#{msg.senha_repetida}" />
						</p:column>
						<p:column>
							<p:password size="40" placeholder="#{msg.water_senha_rep}"
								maxlength="15" id="repeataSenha" />
							<p:tooltip value="Deve ser igual ao campo senha"
								for="repeataSenha" />
						</p:column>
					</p:row>

				</p:panelGrid>

			</h:form>

			<p:spacer />

			<h:form id="frm">
				<p:growl id="growl" autoUpdate="true" showDetail="true"
					showSummary="true" />

				<p:panelGrid columns="1" layout="grid">
					<p:spacer />
					<p:menubar id="menu_search">
						<p:menuitem>
							<p:outputLabel value="#{msg.nome}" />
						</p:menuitem>
						<p:menuitem>
							<p:spacer width="5" />
						</p:menuitem>
						<p:menuitem>
							<p:inputText id="nome_search" size="100"
								onkeyup="PF('filteredDataTable').filter()"
								placeholder="#{msg.water_procurar}" />
						</p:menuitem>
						<p:menuitem>
							<p:spacer width="5" />
						</p:menuitem>
						<f:facet name="options">
							<p:menuitem>
								<p:commandButton icon="ui-icon-search" value="#{msg.procurar}"
									process="menu_search"
									action="/pages/user/pesquisaUser?faces-redirect=true" />
							</p:menuitem>
						</f:facet>
					</p:menubar>
					<p:dataTable widgetVar="filteredDataTable"
						emptyMessage="Sem usuarios cadastrados" id="dataTable" var="user"
						rows="5" value="#{userBean.users}" paginator="true"
						selectionMode="single" selection="#{userBean.user}"
						rowKey="#{user.id}" filteredValue="#{userBean.filteredUsers}"
						rowsPerPageTemplate="5,10,15">
						<p:ajax event="rowSelect" listener="#{userBean.onRowSelect}"
							update=":frm:growl" />
						<p:column filterBy="#{user.nome}" filterMatchMode="contains"
							headerText="#{msg.nome}">
							<p:outputLabel value="#{user.nome}" style="font-weight: bold;" />
						</p:column>
						<p:column filterBy="#{user.apelido}" filterMatchMode="contains"
							headerText="#{msg.apelido}">
							<p:outputLabel value="#{user.apelido}" />
						</p:column>
						<p:column headerText="#{msg.email}" filterBy="#{user.email}"
							filterMatchMode="contains">
							<p:outputLabel value="#{user.email}" />
						</p:column>
						<p:column headerText="#{msg.list_data_registo}">
							<p:outputLabel value="#{user.created.time}">
								<f:convertDateTime pattern="dd, MMMM yyyy" locale="pt_BR"
									type="date" />
							</p:outputLabel>
						</p:column>
						<p:column headerText="#{msg.contacto}" filterBy="#{user.cell}"
							filterMatchMode="contains">
							<p:outputLabel value="#{user.cell}" />
						</p:column>
						<p:column headerText="#{msg.list_role}" filterMatchMode="contains"
							filterBy="#{user.role}">
							<p:outputLabel value="#{user.role.label}"
								styleClass="#{user.role eq 'ADMIN' ? 'cor_admin' : 'cor_normal'}" />
						</p:column>
						<p:column headerText="">
							<p:commandButton icon="ui-icon-trash"
								onclick="PF('confirmDialog').show()" />

							<p:confirmDialog appendTo="@(body)" modal="true"
								header="Mensagem de confirmacao" widgetVar="confirmDialog"
								message="Deseja apagar usuario?" showEffect="slide"
								hideEffect="slide" id="confrimDialog">

								<!-- <h:form id="confirm_frm"> -->
								<p:commandButton value="Sim"
									oncomplete="PF('confirmDialog').hide()"
									action="#{userBean.deleteUser(user)}" process=":frm:dataTable"
									update=":frm:dataTable" />
								<p:commandButton value="Nao"
									onclick="PF('confirmDialog').hide()" />
								<!-- </h:form> -->
							</p:confirmDialog>

							<p:commandButton update=":frm:frm_update:userDetail"
								oncomplete="PF('update_dialog').show()" icon="ui-icon-pencil"
								process="dataTable" />
							<p:commandButton update=":frm:viewUser"
								oncomplete="PF('view_dialog').show()" icon="ui-icon-search"
								process="dataTable" />
						</p:column>
						<p:columnGroup type="footer">
							<p:row>
								<p:column colspan="6" style="text-align: right;"
									footerText="#{msg.list_numero_utilizadores}" />
								<p:column footerText="#{userBean.totalUsers}" />
							</p:row>
						</p:columnGroup>
					</p:dataTable>
				</p:panelGrid>

				<p:dialog resizable="false" closable="true"
					widgetVar="update_dialog" showEffect="size" closeOnEscape="true"
					hideEffect="size">

					<h:form id="frm_update">
						<p:panelGrid id="userDetail" columns="2">
							<f:facet name="header">
								<p:outputLabel value="Detalhes de: " />
								<p:outputLabel value="#{userBean.user.nome}" />
							</f:facet>

							<p:outputLabel for="edit_nome" value="Nome:" />
							<p:inputText id="edit_nome" value="#{userBean.user.nome}" />

							<p:outputLabel for="edit_apelido" value="Apelido:" />
							<p:inputText id="edit_apelido" value="#{userBean.user.apelido}" />

							<p:outputLabel for="edit_email" value="Email:" />
							<p:inputText size="40" id="edit_email"
								value="#{userBean.user.email}"
								validatorMessage="Formato de email invalido!"
								placeholder="exemplo@email.com">
								<f:validateRegex
									pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
							</p:inputText>

							<p:outputLabel value="Cell:" />
							<p:inputMask mask="(+258)-999-999-999"
								value="#{userBean.user.cell}" />

							<p:outputLabel value="Tipo de usuario:" />
							<p:selectOneMenu value="#{userBean.user.role}">
								<f:selectItem itemLabel="#{msg.water_selecione}" />
								<f:selectItems value="#{userBean.roles}" var="rolex"
									itemValue="#{rolex}" itemLabel="#{rolex.label}" />
							</p:selectOneMenu>

							<f:facet name="footer">
								<p:commandButton icon="ui-icon-refresh"
									action="#{userBean.update}" update=":frm:dataTable"
									value="Actualizar" />
							</f:facet>
						</p:panelGrid>
					</h:form>
				</p:dialog>

				<p:dialog widgetVar="view_dialog" closable="true"
					closeOnEscape="true" modal="false" resizable="false"
					showEffect="slide" hideEffect="slide">
					<p:panelGrid id="viewUser" columns="2">
						<f:facet name="header">
							<p:outputLabel value="Detalhes de: " />
							<p:outputLabel value="#{userBean.user.nome}" />
						</f:facet>

						<p:outputLabel style="font-weight: bold" value="Nome:" />
						<p:outputLabel value="#{userBean.user.nome}" />

						<p:outputLabel style="font-weight: bold" value="Apelido:" />
						<p:outputLabel value="#{userBean.user.apelido}" />

						<p:outputLabel style="font-weight: bold" value="Email:" />
						<p:outputLabel value="#{userBean.user.email}" />

						<p:outputLabel style="font-weight: bold" value="Cell:" />
						<p:outputLabel value="#{userBean.user.cell}" />

						<p:outputLabel style="font-weight: bold" value="Tipo de usuario:" />
						<p:outputLabel value="#{userBean.user.role.label}" />

						<f:facet name="footer">
							<p:commandButton value="Ok" onclick="PF('view_dialog').hide()" />
						</f:facet>

					</p:panelGrid>
				</p:dialog>
			</h:form>

		</ui:define>
	</ui:composition>
</h:body>
</html>
